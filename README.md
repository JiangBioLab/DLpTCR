Predicting immunogenic peptide recognized by TCR through ensemble deep learning
================================================



Overview
--------
Here, we report DLpTCR a computational framework that integrated three deep-learning models 
for predicting the likelihood of the interaction between TCR and peptide presented by 
MHC molecules. DLpTCR obtained excellent performance on independent testing dataset, 
thereby allowing robust identification of immunogenic T cell epitopes.

Installation
------------

This package can be installed in two ways (the easy way):

    # If needed:
    # pip install numpy
    # pip install scipy
    # pip install cvxopt
    pip install -e git+https://github.com/garydoranjr/misvm.git#egg=misvm

or by running the setup file manually

    git clone [the url for misvm]
    cd misvm
    python setup.py install

Note the code depends on the `numpy`, `scipy`, and `cvxopt` packages. So have those
installed first. The build will likely fail if it can't find them. For more information, see:

 + [NumPy](http://www.numpy.org/): Library for efficient matrix math in Python
 + [SciPy](http://www.scipy.org/): Library for more MATLAB-like functionality
 + [CVXOPT](http://cvxopt.org/): Efficient convex (including quadratic program) optimization

Contents
--------

data
--------
We collected experimentally verified TCR-pMHC pairs from the VDJdb, IEDB and  
TetTCR-seq dataset for constructing a high-quality benchmark dataset. These peptide-TCR pairs were 
split into training, testing and independent testing datasets with regard to their TCR α- and β-chains 
so that each peptide-TCR pair only existed in one split, in detail as following: 
1)TCRA_train.csv and TRB_Train.csv are the training datasets for constructing and training the models.
2)TCRA_test.csv and TCRB_test.csv are the testing datasets for testing the constructed models.
3)TCRA_COVID-19.csv and TCRB_COVID-19.csv are independent testing data for evaluating the performance of 
ensemble classifiers.
4)TRA-VDJdb_TCR cross-reactivity.rar and TRB_VDJdb_TCR cross-reactivity.rar are used to assess the 
prediction ability of ensemble classifiers for TCR cross-reactivity.
5)TCRAB_IEDB.csv is used to evaluate the integrated model for predicting the peptide-TCRαβ interaction.

model
--------
The final base classifiers of DLpTCR are deposited in this folder. 
1) FULL_A_ALL_onehot.h5, CNN_A_ALL_onehot.h5 and RESNET_A_ALL_pca15.h5 are the base classifiers of ensemble 
model for predicting the peptide-TCRα interaction.
2) FULL_B_ALL_pca18.h5, CNN_B_ALL_pca20.h5 and RESNET_B_ALL_pca10.h5 are the base classifiers of ensemble 
model for predicting the peptide-TCRβ interaction.

pca
--------
The folder contains the features generated by full training datasets using PCA encoding method.
we padded each sequence of a pair to the maximum length of 20 and encoded them using Principal 
Component Analysis (PCA) encoding. For each amino acid, we selected the top 20 PCs explained 
over 95% of total data variation and generated different vectors using 8-20 PCs to represent 
its biochemical signatures, respectively.


code
--------
The source code of feature extraction, five-fold cross-validation, model construction and training,
and prediction are deposited in this floder 'code'.
1) The source code in folder 'fold' are used to select the appropriate features by five-fold cross validation.
2) The source code in folder 'train' are used to construct and train the base classifiers.
3) The source code (feature extraction.py) is used to implement feature extraction.
4) The source code (DLpTCR.py) is used to predict the peptide-TCR interaction.


How to Use
----------




    >>> from Feature_Extraction import *
    >>> from DLpTCR_server import *
    >>> input_file_path = '../data/Example_file.xlsx'


Please refer to document 'Example_file.xlsx' for the format of the input file.
Column names are not allowed to change.



    >>> model_select = "AB"  


model:pTCRα    user_select = "A" 
model:pTCRβ    user_select = "B" 
model:pTCRαβ  user_select = "AB" 



    >>> job_dir_name = 'test'
    >>> user_dir = './user/' + str(job_dir_name) + '/'


The predicted files will be stored in the path "user_dir".

    >>> user_dir_Exists = os.path.exists(user_dir)
    >>> if not user_dir_Exists: 
    >>>     os.makedirs(user_dir)
    
    >>> error_info,TCRA_cdr3,TCRB_cdr3,Epitope = deal_file(input_file_path, user_dir, model_select)
    >>> output_file_path = save_outputfile(user_dir, user_select, input_file_path,TCRA_cdr3,TCRB_cdr3,Epitope)











The classifier implementations are loosely based on those found in the
[scikit-learn](http://scikit-learn.org/stable/) library. First, construct a
classifier with the desired parameters:

    >>> import misvm
    >>> classifier = misvm.MISVM(kernel='linear', C=1.0, max_iters=50)

Use Python's `help` functionality as in `help(misvm.MISVM)` or read the
documentation in the code to see which arguments each classifier takes. Then,
call the `fit` function with some data:

    >>> classifier.fit(bags, labels)

Here, the `bags` argument is a list of "array-like" (could be NumPy arrays, or a
list of lists) objects representing each bag. Each (array-like) bag has m rows
and f columns, which correspond to m instances, each with f features. Of course,
m can be different across bags, but f must be the same. Then `labels` is an
array-like object containing a label corresponding to each bag. *Each label must
be either +1 or -1.* You will likely get strange results if you try using
0/1-valued labels. After training the classifier, you can call the `predict`
function as:

    >>> labels = classifier.predict(bags)

Here `bags` has the same format as for `fit`, and the function returns an array
of real-valued predictions (use `numpy.sign(labels)` to get -1/+1 class
predictions).

In order to get instance-level predictions from a classifier, use the
`instancePrediction` flag, as in:

    >>> bag_labels, instance_labels = classifier.predict(bags, instancePrediction=True)

The `instancePrediction` flag is not available for bag-level classifiers such
as the NSK. However, you can always predict the labels of "singleton" bags
containing a single instance to assign a label to that instance. In this case,
one should use caution in interpreting the label of an instance produced by a
bag-level classifier, since these classifiers are designed to make predictions
based on properties of an entire bag.

An example script is included that trains classifiers on the [musk1
dataset](http://archive.ics.uci.edu/ml/datasets/Musk+(Version+1)); see:
> Bache, K. & Lichman, M. (2013). UCI Machine Learning Repository
> [http://archive.ics.uci.edu/ml]. Irvine, CA: University of California, School
> of Information and Computer Science.

Install the package or add the `misvm` directory to the `PYTHONPATH` environment
variable before attempting to run the example using `python example.py` within
the `example` directory.


